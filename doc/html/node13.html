<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 2002-2-1 (1.70)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>12. Sympa SOAP server</TITLE>
<META NAME="description" CONTENT="12. Sympa SOAP server">
<META NAME="keywords" CONTENT="sympa">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v2002-2-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="sympa.css">

<LINK REL="next" HREF="node14.html">
<LINK REL="previous" HREF="node12.html">
<LINK REL="up" HREF="sympa.html">
<LINK REL="next" HREF="node14.html">
</HEAD>

<BODY TEXT="#000000" BGCOLOR="#ffffff">
<!--Navigation Panel-->
<A NAME="tex2html1173"
  HREF="node14.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1167"
  HREF="sympa.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1161"
  HREF="node12.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1169"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html1171"
  HREF="node31.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1174"
  HREF="node14.html">13. Authentication</A>
<B> Up:</B> <A NAME="tex2html1168"
  HREF="sympa.html">Sympa Mailing Lists Management Software version</A>
<B> Previous:</B> <A NAME="tex2html1162"
  HREF="node12.html">11. Sympa RSS channel</A>
 &nbsp; <B>  <A NAME="tex2html1170"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html1172"
  HREF="node31.html">Index</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1175"
  HREF="node13.html#SECTION001310000000000000000">12.1 Introduction</A>
<LI><A NAME="tex2html1176"
  HREF="node13.html#SECTION001320000000000000000">12.2 Web server setup</A>
<LI><A NAME="tex2html1177"
  HREF="node13.html#SECTION001330000000000000000">12.3 Sympa setup</A>
<LI><A NAME="tex2html1178"
  HREF="node13.html#SECTION001340000000000000000">12.4 trust remote application</A>
<LI><A NAME="tex2html1179"
  HREF="node13.html#SECTION001350000000000000000">12.5 The WSDL service description</A>
<LI><A NAME="tex2html1180"
  HREF="node13.html#SECTION001360000000000000000">12.6 Client-side programming</A>
<UL>
<LI><A NAME="tex2html1181"
  HREF="node13.html#SECTION001361000000000000000">12.6.1 Writting a Java client with Axis</A>
</UL></UL>
<!--End of Table of Child-Links-->
<HR>

<H1><A NAME="SECTION001300000000000000000"></A>
<A NAME="soap"></A>
<BR>
12. Sympa SOAP server
</H1>

<P>

<H1><A NAME="SECTION001310000000000000000">
12.1 Introduction</A>
</H1>

<P>
<A NAME="tex2html33"
  HREF="http://www.w3.org/2002/ws/">SOAP</A>
is one protocol (generally over HTTP) that 
can be used to provide <B>web services</B>. Sympa SOAP server allows to access a Sympa service 
from within another program, written in any programming language and on any computer. SOAP encapsulates 
procedure calls, input parameters and resulting data in an XML data structure. The Sympa SOAP server's
API is published in a <B>WSDL </B> document, retreived via Sympa's web interface.

<P>
The SOAP server provides a limited set of high level functions including <TT>login</TT>, <TT>which</TT>,
<TT>lists</TT>, <TT>subscribe</TT>, <TT>signoff</TT> and list creation. Other functions might be implemented in the future. One
of the important implementation constraint is to provide services for proxy application with a correct authorization evaluation
processus where authentication may differ from classic web method. The following cases can be used to access to the service :

<UL>
<LI>The client first ask for a login and later service request provide the <TT>sympa-user</TT> cookie.
</LI>
<LI>The client provide user email and password and request a service in a single soap access using the <TT>authenticateAndRun</TT> soap service.
</LI>
<LI>The client is a trusted by Sympa as a proxy application and is authorized to set some variables that will be used by 
         Sympa during the authorization scenario evaluation. Trusted application have there own password and the variables they can set are listed in
         a configuration file name  <A NAME="9297"></A><TT>trusted_applications.conf</TT>. See <A HREF="#trustedapplications">12.4</A> page&nbsp;<A HREF="node13.html#trustedapplications"><IMG  ALIGN="BOTTOM" BORDER="1" ALT="[*]" SRC="crossref.png"></A>.
</LI>
</UL>

<P>
In any case scenario authorization is used with same rules as mail interface or usual web interface.

<P>
The SOAP server uses <A NAME="tex2html34"
  HREF="http://www.soaplite.com/">SOAP::Lite</A>
Perl library. The server 
is running as a daemon (thanks to FastCGI), receiving the client SOAP requests via a web server (Apache 
for example).

<P>

<H1><A NAME="SECTION001320000000000000000">
12.2 Web server setup</A>
</H1>

<P>
You <B>NEED TO</B> install FastCGI for the SOAP server to work properly because it will run as a daemon.

<P>
Here is a sample piece of your Apache <A NAME="9300"></A><TT>httpd.conf</TT> with a SOAP server configured :<PRE>
	FastCgiServer /usr/local/sympa-os/bin/sympa_soap_server.fcgi -processes 1
	ScriptAlias /sympasoap /usr/local/sympa-os/bin/sympa_soap_server.fcgi

	&lt;Location /sympasoap&gt;
   	  SetHandler fastcgi-script
	&lt;/Location&gt;
</PRE>

<P>

<H1><A NAME="SECTION001330000000000000000">
12.3 Sympa setup</A>
</H1>

<P>
The only mandatory parameter you need to set in <A NAME="9303"></A><TT>sympa.conf</TT>/<A NAME="9306"></A><TT>robot.conf</TT> files is
the <A NAME="9309"></A><TT>soap_url</TT> that defines the URL of the SOAP service corresponding
to the ScriptAlias you've previously setup in Apache config. 

<P>
This parameter is used to publish the SOAP service URL in the WSDL file (defining the API) but
also for the SOAP server to deduce what Virtual Host is concerned by the current SOAP request 
(a single SOAP server will serve all Sympa virtual hosts).

<P>

<H1><A NAME="SECTION001340000000000000000"></A>
<A NAME="trustedapplications"></A>
<BR>
12.4 trust remote application
</H1>

<P>
The SOAP service <A NAME="9312"></A><TT>authenticateRemoteAppAndRun</TT> is used in order to allow some remote application such as a web portal to request Sympa service as a proxy for the end user. In such case, Sympa will not authenticate the end user itself but instead it will trust a particular application to act as a proxy. 

<P>
This configuration file <A NAME="9315"></A><TT>trusted_applications.conf</TT> can be created in the robot <A NAME="9318"></A><TT>etc/</TT> subdirectory or in <A NAME="9321"></A><TT>/usr/local/sympa-os/etc</TT> directory depending on the scope you want for it (the source package include a sample of file <A NAME="9324"></A><TT>trusted_applications.conf</TT> in directory <A NAME="9327"></A><TT>soap</TT>). This file is constructed with paragraphs separated by empty line and stating with key word  <A NAME="9330"></A><TT>trusted_application</TT>. A sample <A NAME="9333"></A><TT>trusted_applications.conf</TT> file is provided with Sympa sources. Each paragraph defines a remote trusted application with keyword/value pairs

<P>

<UL>
<LI><A NAME="9336"></A><TT>name</TT> : the name of the application. Used with password for authentication ; the <A NAME="9339"></A><TT>remote_application_name</TT> variable is set for use in authorization scenarios.
</LI>
<LI><A NAME="9342"></A><TT>md5password</TT> : the MD5 digest of the application password. You can compute the digest as follows :  <A NAME="9345"></A><TT>sympa.pl -md5_digest=&lt;the password&gt;</TT>.
</LI>
<LI><A NAME="9348"></A><TT>proxy_for_variables</TT> : a comma separated list of variables that can be set by the remote application and that will be used by Sympa SOAP server when evaluating an authorization scenario. If you list <A NAME="9351"></A><TT>USER_EMAIL</TT> in this parameter, then the remote application can act as a user. Any other variable such as  <A NAME="9354"></A><TT>remote_host</TT> can be listed.

<P>
</LI>
</UL>

<P>
You can test your SOAP service using the <A NAME="9357"></A><TT>sympa_soap_client.pl</TT> sample script as follows :<PRE>
/usr/local/sympa-os/bin/sympa_soap_client.pl --soap_url=http://my.server/sympasoap --service=createList --trusted_application=myTestApp --trusted_application_password=myTestAppPwd --proxy_vars="USER_EMAIL=userProxy@my.server" --service_parameters=listA,listSubject,discussion_list,description,myTopic

/usr/local/sympa-os/bin/sympa_soap_client.pl --soap_url=http://myserver/sympasoap --service=add --trusted_application=myTestApp --trusted_application_password=myTestAppPwd  --proxy_vars="USER_EMAIL=userProxy@my.server" --service_parameters=listA,someone@some;domain,name
</PRE>

<P>
Availible services are :

<UL>
<LI>info &lt;list&gt;
</LI>
<LI>which
</LI>
<LI>lists
</LI>
<LI>review &lt;list&gt;
</LI>
<LI>amI &lt;function&gt;
</LI>
<LI>subscribe  &lt;list&gt; 
</LI>
<LI>signoff &lt;list&gt;
</LI>
<LI>add &lt;list&gt;&lt;email&gt;
</LI>
<LI>del &lt;list&gt;&lt;email&gt;
</LI>
<LI>createList &lt;list&gt;...
</LI>
<LI>closeList &lt;list&gt;
</LI>
<LI>login &lt;email&gt;&lt;password&gt;
</LI>
<LI>casLogin &lt;proxyTicket&gt;
</LI>
<LI>checkCookie
</LI>
</UL>

<P>

<H1><A NAME="SECTION001350000000000000000">
12.5 The WSDL service description</A>
</H1>

<P>
Here is what the WSDL file looks like before it is parsed by WWSympa :

<P><PRE>
&lt;?xml version="1.0"?&gt;
&lt;definitions name="Sympa" 
	xmlns:xsd="http://www.w3.org/2001/XMLSchema" 
	xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" 
	targetNamespace="[% conf.wwsympa_url %]/wsdl" 
	xmlns:tns="[% conf.wwsympa_url %]/wsdl"
	xmlns="http://schemas.xmlsoap.org/wsdl/" 
	xmlns:xsdl="[% conf.soap_url %]/wsdl"&gt;


&lt;!-- types part --&gt;	


&lt;types&gt;
&lt;schema targetNamespace="[% conf.wwsympa_url %]/wsdl" 
	xmlns:SOAP-ENC="http://schemas.xmlsoap.org/soap/encoding/" 
	xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" 
	xmlns="http://www.w3.org/2001/XMLSchema"&gt;
	
	&lt;complexType name="ArrayOfLists"&gt;
		&lt;complexContent&gt;
			&lt;restriction base="SOAP-ENC:Array"&gt;
				&lt;attribute ref="SOAP-ENC:arrayType" wsdl:arrayType="tns:listType[]"/&gt;
			&lt;/restriction&gt;
		&lt;/complexContent&gt;
	&lt;/complexType&gt;

	&lt;complexType name="ArrayOfString"&gt;
		&lt;complexContent&gt;
			&lt;restriction base="SOAP-ENC:Array"&gt;
				&lt;attribute ref="SOAP-ENC:arrayType" wsdl:arrayType="string[]"/&gt;
			&lt;/restriction&gt;
		&lt;/complexContent&gt;
	&lt;/complexType&gt;
	
	&lt;complexType name="listType"&gt;
           &lt;all&gt;
		&lt;element name="listAddress" minOccurs="1" type="string"/&gt;
		&lt;element name="homepage" minOccurs="0" type="string"/&gt;
		&lt;element name="isSubscriber" minOccurs="0" type="boolean"/&gt;
		&lt;element name="isOwner" minOccurs="0" type="boolean"/&gt;
		&lt;element name="isEditor" minOccurs="0" type="boolean"/&gt;
		&lt;element name="subject" minOccurs="0" type="string"/&gt;
           &lt;/all&gt;
	&lt;/complexType&gt;
&lt;/schema&gt;
&lt;/types&gt;


&lt;!-- message part --&gt;

&lt;message name="infoRequest"&gt;
        &lt;part name="listName" type="xsd:string"/&gt;
&lt;/message&gt;

&lt;message name="infoResponse"&gt;
	&lt;part name="return" type="tns:listType"/&gt;
&lt;/message&gt;

&lt;message name="complexWhichRequest"&gt;
&lt;/message&gt;

&lt;message name="complexWhichResponse"&gt;
	&lt;part name="return" type="tns:ArrayOfLists"/&gt;
&lt;/message&gt;

&lt;message name="whichRequest"&gt;
&lt;/message&gt;

&lt;message name="whichResponse"&gt;
	&lt;part name="return" type="tns:ArrayOfString"/&gt;
&lt;/message&gt;

&lt;message name="amIRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;
	&lt;part name="function" type="xsd:string"/&gt;
	&lt;part name="user" type="xsd:string"/&gt;
&lt;/message&gt;

&lt;message name="amIResponse"&gt;
	&lt;part name="return" type="xsd:boolean"/&gt;
&lt;/message&gt;

&lt;message name="reviewRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;
&lt;/message&gt;

&lt;message name="reviewResponse"&gt;
	&lt;part name="return" type="tns:ArrayOfString"/&gt;
&lt;/message&gt;

&lt;message name="signoffRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;
	&lt;part name="email" type="xsd:string" xsd:minOccurs="0"/&gt;	
&lt;/message&gt;

&lt;message name="signoffResponse"&gt;
	&lt;part name="return" type="xsd:boolean"/&gt;
&lt;/message&gt;

&lt;message name="subscribeRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;
	&lt;part name="gecos" type="xsd:string" xsd:minOccurs="0"/&gt;	
&lt;/message&gt;

&lt;message name="addRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;		
	&lt;part name="email" type="xsd:string"/&gt;
	&lt;part name="gecos" type="xsd:string"  xsd:minOccurs="0"//&gt;	
	&lt;part name="quiet" type="xsd:boolean"  xsd:minOccurs="0"//&gt;	
&lt;/message&gt;


&lt;message name="addResponse"&gt;
	&lt;part name="return" type="xsd:boolean"/&gt;
&lt;/message&gt;

&lt;message name="delRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;		
	&lt;part name="email" type="xsd:string"/&gt;
	&lt;part name="quiet" type="xsd:boolean"  xsd:minOccurs="0"//&gt;	
&lt;/message&gt;


&lt;message name="delResponse"&gt;
	&lt;part name="return" type="xsd:boolean"/&gt;
&lt;/message&gt;

&lt;message name="createListRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;
	&lt;part name="subject" type="xsd:string"/&gt;
	&lt;part name="template" type="xsd:string"/&gt;
	&lt;part name="description" type="xsd:string"/&gt;
	&lt;part name="topics" type="xsd:string"/&gt;
&lt;/message&gt;

&lt;message name="createListResponse"&gt;
	&lt;part name="return" type="xsd:boolean"/&gt;
&lt;/message&gt;

&lt;message name="closeListRequest"&gt;
	&lt;part name="list" type="xsd:string"/&gt;
&lt;/message&gt;

&lt;message name="closeListResponse"&gt;
	&lt;part name="return" type="xsd:boolean"/&gt;
&lt;/message&gt;

&lt;message name="subscribeResponse"&gt;
	&lt;part name="return" type="xsd:boolean"/&gt;
&lt;/message&gt;

&lt;message name="loginRequest"&gt;
	&lt;part name="email" type="xsd:string"/&gt;
	&lt;part name="password" type="xsd:string"/&gt;
&lt;/message&gt;

&lt;message name="loginResponse"&gt;
	&lt;part name="return" type="xsd:string"/&gt;	
&lt;/message&gt;

&lt;message name="authenticateAndRunRequest"&gt;
	&lt;part name="email" type="xsd:string"/&gt;
	&lt;part name="cookie" type="xsd:string"/&gt;
	&lt;part name="service" type="xsd:string"/&gt;
	&lt;part name="parameters" type="tns:ArrayOfString" xsd:minOccurs="0"/&gt;
&lt;/message&gt;

&lt;message name="authenticateAndRunResponse"&gt;
	&lt;part name="return" type="tns:ArrayOfString" xsd:minOccurs="0"/&gt;	
&lt;/message&gt;

&lt;message name="authenticateRemoteAppAndRunRequest"&gt;
	&lt;part name="appname" type="xsd:string"/&gt;
	&lt;part name="apppassword" type="xsd:string"/&gt;
	&lt;part name="vars" type="xsd:string"/&gt;
	&lt;part name="service" type="xsd:string"/&gt;
	&lt;part name="parameters" type="tns:ArrayOfString" xsd:minOccurs="0"/&gt;
&lt;/message&gt;

&lt;message name="authenticateRemoteAppAndRunResponse"&gt;
	&lt;part name="return" type="tns:ArrayOfString" xsd:minOccurs="0"/&gt;	
&lt;/message&gt;

&lt;message name="casLoginRequest"&gt;
	&lt;part name="proxyTicket" type="xsd:string"/&gt;
&lt;/message&gt;

&lt;message name="casLoginResponse"&gt;
	&lt;part name="return" type="xsd:string"/&gt;	
&lt;/message&gt;

&lt;message name="listsRequest"&gt;
	&lt;part name="topic" type="xsd:string" xsd:minOccurs="0"/&gt;
	&lt;part name="subtopic" type="xsd:string" xsd:minOccurs="0"/&gt;
&lt;/message&gt;

&lt;message name="listsResponse"&gt;
	&lt;part name="listInfo" type="xsd:string"/&gt;	
&lt;/message&gt;

&lt;message name="complexListsRequest"&gt;
&lt;/message&gt;

&lt;message name="complexListsResponse"&gt;
	&lt;part name="return" type="tns:ArrayOfLists"/&gt;
&lt;/message&gt;

&lt;message name="checkCookieRequest"&gt;
&lt;/message&gt;

&lt;message name="checkCookieResponse"&gt;
	&lt;part name="email" type="xsd:string"/&gt;
&lt;/message&gt;


&lt;!-- portType part --&gt;

&lt;portType name="SympaPort"&gt;
	&lt;operation name="info"&gt;
		&lt;input message="tns:infoRequest" /&gt;
		&lt;output message="tns:infoResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="complexWhich"&gt;
		&lt;input message="tns:complexWhichRequest" /&gt;
		&lt;output message="tns:complexWhichResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="which"&gt;
		&lt;input message="tns:whichRequest" /&gt;
		&lt;output message="tns:whichResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="amI"&gt;
		&lt;input message="tns:amIRequest" /&gt;
		&lt;output message="tns:amIResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="add"&gt;
		&lt;input message="tns:addRequest" /&gt;
		&lt;output message="tns:addResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="del"&gt;
		&lt;input message="tns:delRequest" /&gt;
		&lt;output message="tns:delResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="createList"&gt;
		&lt;input message="tns:createListRequest" /&gt;
		&lt;output message="tns:createListResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="closeList"&gt;
		&lt;input message="tns:closeListRequest" /&gt;
		&lt;output message="tns:closeListResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="review"&gt;
		&lt;input message="tns:reviewRequest" /&gt;
		&lt;output message="tns:reviewResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="subscribe"&gt;
		&lt;input message="tns:subscribeRequest" /&gt;
		&lt;output message="tns:subscribeResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="signoff"&gt;
		&lt;input message="tns:signoffRequest" /&gt;
		&lt;output message="tns:signoffResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="login"&gt;
		&lt;input message="tns:loginRequest" /&gt;
		&lt;output message="tns:loginResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="casLogin"&gt;
		&lt;input message="tns:casLoginRequest" /&gt;
		&lt;output message="tns:casLoginResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="authenticateAndRun"&gt;
		&lt;input message="tns:authenticateAndRunRequest" /&gt;
		&lt;output message="tns:authenticateAndRunResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="authenticateRemoteAppAndRun"&gt;
		&lt;input message="tns:authenticateRemoteAppAndRunRequest" /&gt;
		&lt;output message="tns:authenticateRemoteAppAndRunResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="lists"&gt;
		&lt;input message="tns:listsRequest" /&gt;
		&lt;output message="tns:listsResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="complexLists"&gt;
		&lt;input message="tns:complexListsRequest" /&gt;
		&lt;output message="tns:complexListsResponse" /&gt;
	&lt;/operation&gt;
	&lt;operation name="checkCookie"&gt;
		&lt;input message="tns:checkCookieRequest" /&gt;
		&lt;output message="tns:checkCookieResponse" /&gt;
	&lt;/operation&gt;
&lt;/portType&gt;


&lt;!-- Binding part --&gt;

&lt;binding name="SOAP" type="tns:SympaPort"&gt;
&lt;soap:binding style="rpc" transport="http://schemas.xmlsoap.org/soap/http"/&gt;
	&lt;operation name="info"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#info"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="complexWhich"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#complexWhich"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="which"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#which"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="amI"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#amI"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="createList"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#createList"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="review"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#review"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="subscribe"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#subscribe"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="signoff"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#signoff"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="login"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#login"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="casLogin"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#casLogin"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="authenticateAndRun"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#authenticateAndRun"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="authenticateRemoteAppAndRun"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#authenticateRemoteAppAndRun"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="lists"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#lists"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="complexLists"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#complexLists"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
	&lt;operation name="checkCookie"&gt;
		&lt;soap:operation soapAction="urn:sympasoap#checkCookie"/&gt;
			&lt;input&gt;
				&lt;soap:body use="encoded" 
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/input&gt;
			&lt;output&gt;
				&lt;soap:body use="encoded"
					namespace="urn:sympasoap" 
					encodingStyle="http://schemas.xmlsoap.org/soap/encoding/"/&gt;
			&lt;/output&gt;
	&lt;/operation&gt;
&lt;/binding&gt;

&lt;!-- service part --&gt;


&lt;service name="SympaSOAP"&gt;
	&lt;port name="SympaPort" binding="tns:SOAP"&gt;
		&lt;soap:address location="[% conf.soap_url %]"/&gt;
	&lt;/port&gt;
&lt;/service&gt;

&lt;/definitions&gt;
</PRE>

<P>

<H1><A NAME="SECTION001360000000000000000">
12.6 Client-side programming</A>
</H1>

<P>
Sympa is distributed with 2 sample clients written in Perl and in PHP. Sympa SOAP server has also
been successfully tested with a UPortal Chanel as a Java client (using Axis). The sample PHP SOAP
client has been installed on our demo server :  <A NAME="tex2html35"
  HREF="http://demo.sympa.org/sampleClient.php">http://demo.sympa.org/sampleClient.php</A>.

<P>
Depending on your programming language and the SOAP library you're using, you will either directly 
contact the SOAP service (as with Perl SOAP::Lite library) or first load the WSDL description of
the service (as with PHP nusoap or Java Axis). Axis is able to create a stub from the WSDL document.

<P>
The WSDL document describing the service should be fetch through WWSympa's dedicated URL :
<B>http://your.server/sympa/wsdl</B>.

<P>
Note : the <B>login()</B> function maintains a login session using HTTP cookies. If you are not able
to maintain this session by analysing and sending appropriate cookies under SOAP, then you
should use the <B>authenticateAndRun()</B> function that does not require cookies to authenticate.

<P>

<H2><A NAME="SECTION001361000000000000000">
12.6.1 Writting a Java client with Axis</A>
</H2>

<P>
First, download jakarta-axis (http://ws.apache.org/axis/)
<BR>
<P>
You must add the libraries provided with jakarta axis (v &gt;1.1) to you CLASSPATH. These libraries are  :

<P>

<UL>
<LI>axis.jar
</LI>
<LI>saaj.jar
</LI>
<LI>commons-discovery.jar
</LI>
<LI>commons-logging.jar
</LI>
<LI>xercesImpl.jar
</LI>
<LI>jaxrpc.jar
</LI>
<LI>xml-apis.jar
</LI>
<LI>jaas.jar
</LI>
<LI>wsdl4j.jar
</LI>
<LI>soap.jar
</LI>
</UL>

<P>
Next, you have to generate client java classes files from the sympa WSDL url. Use the following command :
<BR>
<P>
java org.apache.axis.wsdl.WSDL2Java -av  WSDL_URL
<BR>
<P>
For example :
<PRE>
java org.apache.axis.wsdl.WSDL2Java -av  http://demo.sympa.org/sympa/wsdl
</PRE>

<P>
Exemple of screen output during generation of java files :
<BR> <PRE>
Parsing XML file:  http://demo.sympa.org/sympa/wsdl
Generating org/sympa/demo/sympa/msdl/ListType.java
Generating org/sympa/demo/sympa/msdl/SympaPort.java
Generating org/sympa/demo/sympa/msdl/SOAPStub.java
Generating org/sympa/demo/sympa/msdl/SympaSOAP.java
Generating org/sympa/demo/sympa/msdl/SympaSOAPLocator.java
</PRE>

<P>
If you need  more information or more generated classes (to have the server-side classes or junit testcase classes for example), you can get a list of switches :
<BR>    <PRE>
java org.apache.axis.wsdl.WSDL2Java -h
</PRE>
The reference page is :
<BR>
http://ws.apache.org/axis/java/reference.html

<P>
Take care of Test classes generated by axis, there are not useable as is. You have to stay connected between each test. To use junit testcases, before each soap operation tested, you must call the authenticated connexion to sympa instance.

<P>
Here is a simple Java code that invokes the generated stub to perform a casLogin() and a which() on the remote Sympa SOAP server :
<PRE>
SympaSOAP loc = new SympaSOAPLocator();
((SympaSOAPLocator)loc).setMaintainSession(true);
SympaPort tmp = loc.getSympaPort();
String _value = tmp.casLogin(_ticket);
String _cookie = tmp.checkCookie();
String[] _abonnements = tmp.which();
</PRE>

<P>

<HR>
<!--Navigation Panel-->
<A NAME="tex2html1173"
  HREF="node14.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html1167"
  HREF="sympa.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html1161"
  HREF="node12.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html1169"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html1171"
  HREF="node31.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html1174"
  HREF="node14.html">13. Authentication</A>
<B> Up:</B> <A NAME="tex2html1168"
  HREF="sympa.html">Sympa Mailing Lists Management Software version</A>
<B> Previous:</B> <A NAME="tex2html1162"
  HREF="node12.html">11. Sympa RSS channel</A>
 &nbsp; <B>  <A NAME="tex2html1170"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html1172"
  HREF="node31.html">Index</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
root
2006-10-03
</ADDRESS>
</BODY>
</HTML>
